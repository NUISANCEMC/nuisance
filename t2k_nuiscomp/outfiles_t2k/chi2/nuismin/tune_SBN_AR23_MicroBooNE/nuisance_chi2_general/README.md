# For clean_map_chi2_total_genral.C 

The Nominal (I'm calling it 0p: no parameters have been changed) "nuiscomp_0p.root" file is generated by running a card file. So there will be two file - 1) "nuiscomp_0p.card" for defining a GENIE tune, sample name and the GENIE flux and 2) "run_nuiscomp_0p.sh" file for generating output. The nominal card will look something like this:

#=============== nuiscomp_0p.card ====================
<nuisance>
	<config UseSVDInverse="1"/>
	<config GENIETune="AR23_20i_00_000" GENIEWeightEngine_CCQEMode="kModeZExp" FitWeight_fGenieRW_veto="hadro_fzone"/>
	<sample name="MicroBooNE_CC1Mu1p_XSec_1DMuonMomentum_nu" input="GENIE:/exp/dune/app/users/your_username/generators/genie/sbn_genie/MicroBooNE/14_1000180400_CC_v3_4_0_AR23_20i_00_000.gprep.root" />
</nuisance>
#============== nuiscomp_0p.card ======================

and the runfile something like this

#=================!! run_nuiscomp_0p.sh !!============
nuiscomp \
	-c /exp/dune/app/users/your_username/cards/MicroBooNE_cards/nuiscomp_0p_uboone_pmu.card \
	-o /exp/dune/data/users/your_username/MicroBooNE_outfiles/nuiscomp_0p_uboone_pmu.root // 

echo "It took $SECONDS seconds for this script to execute." 
#===================!! run_nuiscomp_0p.sh !!==========



But if you want to change the parameters (let's say I'm varying six parameters) and do a best fit, you have to take nuismin into account. The "nuismin_6p.root" is generated by a card file with following outline:

#~~~~~~~~~~~~~~~~~~~~~~ nuismin_6p.card ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Here RPA_CCQE, b[4-1], NormCCMEC are different parameters
<nuisance>
	<config UseSVDInverse="1"/>
	<config GENIETune="AR23_20i_00_000" GENIEWeightEngine_CCQEMode="kModeZExp" FitWeight_fGenieRW_veto="hadro_fzone"/>
	<sample name="MicroBooNE_CC1Mu1p_XSec_1DMuonMomentum_nu" input="GENIE:/exp/dune/app/users/your_username/generators/genie/sbn_genie/MicroBooNE/14_1000180400_CC_v3_4_0_AR23_20i_00_000.gprep.root" />
        <parameter type="nusyst_parameter" name="RPA_CCQE" nominal="0" low="-5" high="5" step="0.1" state="FREE"/>
        <covar name="RPA_CCQE" input="DIAL:RPA_CCQE;0;1" type="GENIE:GAUSPULL:FRAC:"/>
	<parameter type="nusyst_parameter" name="b4" nominal="0" low="-5" high="5" step="0.1" state="FREE"/>
        <covar name="b4" input="DIAL:b4;0;1" type="GENIE:GAUSPULL:FRAC:"/>
	<parameter type="nusyst_parameter" name="b3" nominal="0" low="-5" high="5" step="0.1" state="FREE"/>
        <covar name="b3" input="DIAL:b3;0;1" type="GENIE:GAUSPULL:FRAC:"/>
	<parameter type="nusyst_parameter" name="b2" nominal="0" low="-5" high="5" step="0.1" state="FREE"/>
        <covar name="b2" input="DIAL:b2;0;1" type="GENIE:GAUSPULL:FRAC:"/>
	<parameter type="nusyst_parameter" name="b1" nominal="0" low="-5" high="5" step="0.1" state="FREE"/>
        <covar name="b1" input="DIAL:b1;0;1" type="GENIE:GAUSPULL:FRAC:"/>
	<parameter type="nusyst_parameter" name="NormCCMEC" nominal="0" low="-5" high="5" step="0.1" state="FREE"/>
        <covar name="NormCCMEC" input="DIAL:NormCCMEC;0;1" type="GENIE:GAUSPULL:FRAC:"/> // import dials if it's not there in your parameter file
	<DUNERwt ConfigFHiCL="/exp/dune/app/users/your_username/your_parameter_nuiscomp/myParamHeader.fcl"/> // parameter file
</nuisance>
#~~~~~~~~~~~~~~~~~~~~~~ nuismin_6p.card ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
the run file for nuismin will be same as nuiscomp. Just change the filename accordingly.



#~~File for Sample specification
If you look carefully to the card file the first line describes <sample name="MicroBooNE_CC1Mu1p_XSec_1DMuonMomentum_nu"> which means change of coavriance matrix is being infused by this piece of code. The question is how you can modify/change this? The sample lies in following directory /exp/dune/app/users/your_username/GENIETuningStudy/nuisance/nuisance-src/src/MicroBooNE/your_measurement.cxx (In my case MicroBooNE_CC1Mu1p_XSec_1D_nu.cxx)


#~~~File for changing covariance matrix
Now if you're more creative with your data handling and want to study your data around different uncertainities then you have to change the covariance (Remember, covariance cannot be change by changing the values of parameters, you are supposed to make changes in sample "cross_section.root" file. This root file can be find in the directory :/exp/dune/app/users/your_username/GENIETuningStudy/nuisance/nuisance-src/data/your_experiment/cross_section.root (here it's MicroBooNE/CC1Mu1p/All_XSecs_Combined_v08_00_00_52.root) Replace the covariance matrix as Diagonal + off diagonal of first PCA. It's better to save this covariance as a new file instead of messing up with the old one ".cxx" file. 

#~~~Rebuilding Nuisance
So everytime when changes are made in ".cxx" file Nuisance is supposed to be rebuild otherwise it'll keep taking the old input no you'll get the same old result.
/exp/dune/app/users/your_username/GENIETuningStudy/nuisance/build/
make install -j4
# Note: For every new shell opened, these setup scripts must be run 
source Linux/setup.sh

After making these changes, you can specify these new sample names in corresponding nuismin and nuiscomp card files and get the desired "nuismin_0p/6p_modified.root" files.

